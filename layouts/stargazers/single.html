{{ define "main" }}
<div class="container mx-auto px-4 py-8">
  <!-- Header Section -->
  <div class="text-center mb-12">
    <h1 class="text-4xl font-bold mb-4">{{ .Title }}</h1>
    <p class="text-xl text-gray-600 mb-6 max-w-2xl mx-auto">{{ .Description }}</p>
    
    <!-- Call to Action -->
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-8 max-w-2xl mx-auto">
      <p class="text-lg font-semibold mb-4">
        {{ .Params.cta_message }}
      </p>
      <a href="https://github.com/openeverest/openeverest" 
         target="_blank"
         class="inline-flex items-center px-6 py-3 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors">
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        {{ .Params.cta_button_text }}
      </a>
    </div>
  </div>

  <!-- Main Content: Flask and Stargazers -->
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
    <!-- Left Side: Milestone Flask -->
    <div class="lg:col-span-4">
      <div class="sticky top-8">
        <h2 class="text-2xl font-bold mb-6 text-center">{{ .Params.flask_heading }}</h2>
        <div class="flex flex-col items-center">
          <!-- Flask Container -->
          <div class="w-64">
            <div class="relative h-96">
              <!-- Flask SVG -->
              <svg viewBox="0 0 200 400" class="w-full h-full flask-container">
                <defs>
                  <linearGradient id="liquidGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#6366f1;stop-opacity:1" />
                    <stop offset="50%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                  </linearGradient>

                  <pattern id="starPattern" width="20" height="20" patternUnits="userSpaceOnUse">
                    <circle cx="2" cy="2" r="0.8" fill="#ffffff" opacity="0.9">
                      <animate attributeName="opacity" values="0.3;0.9;0.3" dur="2s" repeatCount="indefinite" begin="0s" />
                    </circle>
                    <circle cx="15" cy="8" r="0.6" fill="#ffffff" opacity="0.7">
                      <animate attributeName="opacity" values="0.2;0.7;0.2" dur="1.5s" repeatCount="indefinite" begin="0.5s" />
                    </circle>
                    <circle cx="8" cy="15" r="0.4" fill="#ffffff" opacity="0.5">
                      <animate attributeName="opacity" values="0.1;0.5;0.1" dur="2.5s" repeatCount="indefinite" begin="1s" />
                    </circle>
                  </pattern>

                  <filter id="flaskGlow" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur stdDeviation="2" result="blur" />
                    <feMerge>
                      <feMergeNode in="blur" />
                      <feMergeNode in="SourceGraphic" />
                    </feMerge>
                  </filter>
                </defs>

                <g filter="url(#flaskGlow)">
                  <path d="M 70 30 L 70 340 Q 70 380 100 380 Q 130 380 130 340 L 130 30 Q 130 10 100 10 Q 70 10 70 30 Z"
                        fill="none" stroke="#60a5fa" stroke-width="2" stroke-opacity="0.3" />
                  <path d="M 85 20 L 85 330" fill="none" stroke="white" stroke-width="1" stroke-opacity="0.2" />
                  <circle cx="100" cy="100" r="35" fill="none" stroke="#4ade80" stroke-width="0.5" stroke-opacity="0.3" />
                  <circle cx="100" cy="200" r="35" fill="none" stroke="#4ade80" stroke-width="0.5" stroke-opacity="0.3" />
                  <circle cx="100" cy="300" r="35" fill="none" stroke="#4ade80" stroke-width="0.5" stroke-opacity="0.3" />
                </g>

                <clipPath id="flaskClip">
                  <path d="M 70 30 L 70 340 Q 70 380 100 380 Q 130 380 130 340 L 130 30 Q 130 10 100 10 Q 70 10 70 30 Z" />
                </clipPath>

                <g clip-path="url(#flaskClip)">
                  <rect id="liquidFill" x="70" y="30" width="60" height="350"
                        fill="url(#liquidGradient)"
                        style="transform-origin: center bottom; transform: scaleY(0); transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);" />
                  <rect id="liquidStars" x="70" y="30" width="60" height="350"
                        fill="url(#starPattern)"
                        style="transform-origin: center bottom; transform: scaleY(0); transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);" />
                  <circle cx="90" cy="250" r="1.5" fill="white" opacity="0.6">
                    <animate attributeName="cy" values="250;100" dur="4s" repeatCount="indefinite" begin="0s" />
                    <animate attributeName="opacity" values="0;0.6;0" dur="4s" repeatCount="indefinite" begin="0s" />
                  </circle>
                  <circle cx="110" cy="280" r="1" fill="white" opacity="0.4">
                    <animate attributeName="cy" values="280;120" dur="5s" repeatCount="indefinite" begin="1s" />
                    <animate attributeName="opacity" values="0;0.4;0" dur="5s" repeatCount="indefinite" begin="1s" />
                  </circle>
                </g>

                <!-- Milestone markers -->
                <g id="milestoneMarkers"></g>
              </svg>
            </div>

            <!-- Stats Display -->
            <div class="mt-6 text-center">
              <div class="text-3xl font-bold text-blue-600" id="currentStars">...</div>
              <div class="text-sm text-gray-600 mb-2">Current Stars</div>
              
              <div class="h-px bg-gray-300 my-4"></div>
              
              <div class="text-2xl font-bold text-purple-600" id="nextMilestone">...</div>
              <div class="text-sm text-gray-600 mb-2">Next Milestone</div>
              
              <div class="text-lg font-semibold text-gray-700 mt-4" id="starsNeeded">...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side: Stargazers Grid -->
    <div class="lg:col-span-8">
      <h2 class="text-2xl font-bold mb-6">{{ .Params.stargazers_heading }}</h2>
      
      <!-- Loading State -->
      <div id="loadingState" class="text-center py-12">
        <svg class="animate-spin h-12 w-12 mx-auto text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="mt-4 text-gray-600">Loading stargazers...</p>
      </div>

      <!-- Stargazers Grid -->
      <div id="stargazersGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-8" style="display: none;">
        <!-- Stargazers will be inserted here by JavaScript -->
      </div>

      <!-- Pagination -->
      <div id="pagination" class="flex justify-center items-center gap-2 mt-8" style="display: none;">
        <button id="prevPage" 
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Previous
        </button>
        <span id="pageInfo" class="px-4 py-2 text-gray-700 font-medium"></span>
        <button id="nextPage" 
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Next
        </button>
      </div>

      <!-- Error State -->
      <div id="errorState" class="text-center py-12 text-red-600" style="display: none;">
        <p>Failed to load stargazers. Please try again later.</p>
      </div>
    </div>
  </div>

  <!-- Content from Markdown -->
  <div class="prose max-w-none">
    {{ .Content }}
  </div>
</div>

<script>
  // Stargazers Page JavaScript
  (function() {
    const REPO_OWNER = 'openeverest';
    const REPO_NAME = 'openeverest';
    const PER_PAGE = 50;
    
    let currentPageFromNewest = 1;
    let totalStars = 0;
    let totalPages = 1;
    
    // Calculate next milestone based on current stars
    function calculateMilestones(stars) {
      const milestones = [100, 250, 500, 750, 1000, 1500, 2000, 2500, 3000, 4000, 5000, 7500, 10000, 15000, 20000, 25000, 50000];
      
      let currentMilestone = 0;
      let nextMilestone = milestones[0];
      
      for (let i = 0; i < milestones.length; i++) {
        if (stars >= milestones[i]) {
          currentMilestone = milestones[i];
          nextMilestone = milestones[i + 1] || milestones[i] * 2;
        } else {
          nextMilestone = milestones[i];
          break;
        }
      }
      
      return { currentMilestone, nextMilestone };
    }
    
    // Update flask visualization
    function updateFlask(stars) {
      const { currentMilestone, nextMilestone } = calculateMilestones(stars);
      const progress = currentMilestone > 0 
        ? (stars - currentMilestone) / (nextMilestone - currentMilestone)
        : stars / nextMilestone;
      
      // Update liquid fill
      const liquidFill = document.getElementById('liquidFill');
      if (liquidFill) {
        liquidFill.style.transform = `scaleY(${progress})`;
      }
      
      // Update stats
      document.getElementById('currentStars').textContent = stars.toLocaleString();
      document.getElementById('nextMilestone').textContent = nextMilestone.toLocaleString();
      const starsNeeded = nextMilestone - stars;
      document.getElementById('starsNeeded').textContent = 
        `${starsNeeded.toLocaleString()} star${starsNeeded !== 1 ? 's' : ''} to go!`;
      
      // Add milestone markers
      const markersGroup = document.getElementById('milestoneMarkers');
      if (markersGroup) {
        markersGroup.innerHTML = '';
        
        // Add current and next milestone markers
        const milestones = [currentMilestone, nextMilestone].filter(m => m > 0);
        milestones.forEach(milestone => {
          const milestoneProgress = currentMilestone > 0
            ? (milestone - currentMilestone) / (nextMilestone - currentMilestone)
            : milestone / nextMilestone;
          const y = 380 - (milestoneProgress * 350);
          
          // Line marker
          const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          line.setAttribute('x1', '50');
          line.setAttribute('y1', y);
          line.setAttribute('x2', '150');
          line.setAttribute('y2', y);
          line.setAttribute('stroke', '#6b7280');
          line.setAttribute('stroke-width', '2');
          line.setAttribute('stroke-dasharray', '5,5');
          markersGroup.appendChild(line);
          
          // Text label
          const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text.setAttribute('x', '155');
          text.setAttribute('y', y + 5);
          text.setAttribute('fill', '#374151');
          text.setAttribute('font-size', '14');
          text.setAttribute('font-weight', 'bold');
          text.textContent = milestone.toLocaleString();
          markersGroup.appendChild(text);
        });
      }
    }
    
    // Fetch repository info to get total stars
    async function fetchRepoInfo() {
      try {
        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}`);
        const data = await response.json();
        totalStars = data.stargazers_count;
        totalPages = Math.max(1, Math.ceil(totalStars / PER_PAGE));
        updateFlask(totalStars);
        return totalStars;
      } catch (error) {
        console.error('Error fetching repo info:', error);
        return 0;
      }
    }
    
    // Fetch stargazers for a specific page
    async function fetchStargazers(page) {
      try {
        const response = await fetch(
          `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/stargazers?per_page=${PER_PAGE}&page=${page}`,
          {
            headers: {
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );
        
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error fetching stargazers:', error);
        throw error;
      }
    }

    async function fetchStargazersSlice(pageFromNewest) {
      if (totalStars === 0) {
        return [];
      }

      const endIndex = totalStars - (pageFromNewest - 1) * PER_PAGE;
      const startIndex = Math.max(0, endIndex - PER_PAGE);

      const startPage = Math.floor(startIndex / PER_PAGE) + 1;
      const endPage = Math.floor((endIndex - 1) / PER_PAGE) + 1;

      const startOffset = startIndex % PER_PAGE;
      const endOffset = endIndex % PER_PAGE;

      if (startPage === endPage) {
        const pageData = await fetchStargazers(startPage);
        const slice = pageData.slice(startOffset, endOffset === 0 ? PER_PAGE : endOffset);
        return slice.reverse();
      }

      const [startData, endData] = await Promise.all([
        fetchStargazers(startPage),
        fetchStargazers(endPage),
      ]);

      const startSlice = startData.slice(startOffset);
      const endSlice = endData.slice(0, endOffset === 0 ? PER_PAGE : endOffset);
      const combined = startSlice.concat(endSlice);

      return combined.reverse();
    }
    
    // Render stargazers grid
    function renderStargazers(stargazers) {
      const grid = document.getElementById('stargazersGrid');
      grid.innerHTML = '';
      
      stargazers.forEach(user => {
        const card = document.createElement('a');
        card.href = user.html_url;
        card.target = '_blank';
        card.className = 'flex flex-col items-center p-4 bg-white rounded-lg shadow hover:shadow-lg transition-shadow group';
        
        card.innerHTML = `
          <img src="${user.avatar_url}" 
               alt="${user.login}" 
               class="w-16 h-16 rounded-full mb-2 group-hover:scale-110 transition-transform">
          <span class="text-sm font-medium text-gray-900 text-center truncate w-full">${user.login}</span>
        `;
        
        grid.appendChild(card);
      });
    }
    
    // Update pagination controls
    function updatePagination() {
      document.getElementById('pageInfo').textContent = `Page ${currentPageFromNewest} of ${totalPages}`;
      document.getElementById('prevPage').disabled = currentPageFromNewest === 1;
      document.getElementById('nextPage').disabled = currentPageFromNewest === totalPages;
    }
    
    // Load page
    async function loadPage(pageFromNewest, shouldScroll = false) {
      const loadingState = document.getElementById('loadingState');
      const stargazersGrid = document.getElementById('stargazersGrid');
      const pagination = document.getElementById('pagination');
      const errorState = document.getElementById('errorState');
      
      try {
        loadingState.style.display = 'block';
        stargazersGrid.style.display = 'none';
        pagination.style.display = 'none';
        errorState.style.display = 'none';
        
        const stargazers = await fetchStargazersSlice(pageFromNewest);
        
        renderStargazers(stargazers);
        updatePagination();
        
        loadingState.style.display = 'none';
        stargazersGrid.style.display = 'grid';
        pagination.style.display = 'flex';
        
        if (shouldScroll) {
          stargazersGrid.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      } catch (error) {
        loadingState.style.display = 'none';
        errorState.style.display = 'block';
      }
    }
    
    // Event listeners for pagination
    document.getElementById('prevPage').addEventListener('click', () => {
      if (currentPageFromNewest > 1) {
        currentPageFromNewest--;
        loadPage(currentPageFromNewest, true);
      }
    });
    
    document.getElementById('nextPage').addEventListener('click', () => {
      if (currentPageFromNewest < totalPages) {
        currentPageFromNewest++;
        loadPage(currentPageFromNewest, true);
      }
    });
    
    // Initialize page
    async function init() {
      await fetchRepoInfo();
      currentPageFromNewest = 1;
      await loadPage(currentPageFromNewest, false);
    }
    
    init();
  })();
</script>

<style>
  /* Additional custom styles for the stargazers page */
  #stargazersGrid a {
    text-decoration: none;
  }
  
  #stargazersGrid a:hover {
    transform: translateY(-2px);
  }
  
  /* Sci-fi flask animations */
  .flask-container {
    animation: glowPulse 3s ease-in-out infinite;
  }

  @keyframes glowPulse {
    0%, 100% { filter: drop-shadow(0 0 2px rgba(96, 165, 250, 0.3)); }
    50% { filter: drop-shadow(0 0 6px rgba(96, 165, 250, 0.6)); }
  }

  #liquidFill {
    animation: liquidShimmer 4s linear infinite;
  }

  @keyframes liquidShimmer {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(15deg); }
  }
</style>
{{ end }}
